---
title: "p8105_hw2_lc3807"
author: "Linshen Cai"
date: "`r Sys.Date()`"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
```

## problem 0

```{r library}
library(tidyverse)
library(readxl)
```


## problem 1

```{r}
# creat dataframe of month
month_df = 
  tibble(
    month_num = 1:12,
    month_abb = month.abb,
    month = month.name
  )

#import data frame and clean it as follow
pols = 
  read_csv("./data/fivethirtyeight_datasets/pols-month.csv") |>
  separate(mon, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    president = recode(prez_gop, "0" = "dem", "1" = "gop", "2" = "gop")) |>
  left_join(x = _, y = month_df) |> 
  select(year, month, everything(), -day, -starts_with("prez")) 
```

First, clean the data in pols-month.csv, which shows how many national politicians are now affiliated with either the Democratic Party or the Republican Party. There are several instances where `prez_gop` equals `2`; these are the months in which Ford took office after Nixon resigned. We code these as `gop` (the same as values when `prez_gop` is `1`) in the new `president` variable established as part of our data cleansing.

```{r clean_538_snp}
snp = 
  read_csv(
    "./data/fivethirtyeight_datasets/snp.csv",
    col_types = cols(date = col_date(format = "%m/%d/%y"))) |>
  separate(date, into = c("year", "month_num", "day"), convert = TRUE) |>
  mutate(
    year = if_else(year > 2023, year - 100, year)) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, close) 
```

Second, we also clean the 538 `snp` data, which contains information related to Standard & Poorâ€™s stock market index.

```{r clean_538_unemp}
unemployment = 
  read_csv("./data/fivethirtyeight_datasets/unemployment.csv") |>
  rename(year = Year) |>
  pivot_longer(
    Jan:Dec, 
    names_to = "month_abb",
    values_to = "unemployment"
  ) |> 
  left_join(x = _, y = month_df) |> 
  select(year, month, unemployment)
```

Finally, we tidy the `unemployment` data so that it can be merged with the previous datasets.

```{r merge_538}
data_538 = 
  left_join(pols, snp) |>
  left_join(x = _, y = unemployment)

str(data_538)
```

We merge the three datasets!

The 'pols' data contains `r nrow(pols)` observations and `r ncol(pols)` variables, and it provides information on the distribution of party identification (Democrat or Republican) among governors and senators for a certain year from years.The`snp`data consists of `r nrow(snp)` observations and `r ncol(snp)` variables, which range from years to months.The `unemployment` data includes `r nrow(unemployment)` observations and `r ncol(unemployment)` variables with a range of years.

## Problem 2

First, I import Mr.Trash Wheel sheet from excel and omit non-data entries

```{r clean Mr.Trash Wheel dataset}

#import dataframe use read_excel

mr_trash_wheel_df = 
  read_excel(path = "./data/202309 Trash Wheel Collection Data.xlsx",
             sheet = "Mr. Trash Wheel",
             range = "A2:N586",
             na = c("", "NA", "N/A")
             ) |> 
  janitor::clean_names() |> 
  
  #re-calculate homes powered
  
  mutate(homes_powered = weight_tons * 500 / 30, 
         trash_wheel_type = "Mr. Trash Wheel",
         year = as.double(year)
         )|> 
  select(trash_wheel_type, everything())

mr_trash_wheel_df
```
Second, I import Professor Trash Wheel sheet from excel and omit non-data entries.

```{r clean Professor Trash Wheel dataset}

#import dataframe use read_excel
prof_trash_df = 
  read_excel(
    "./data/202309 Trash Wheel Collection Data.xlsx",
    sheet = "Professor Trash Wheel",
    range = "A2:M108",
    na = c("", "NA", "N/A")
    ) |> 
  janitor::clean_names() |> 
  
#re-calculate homes powered
  mutate(
    homes_powered = weight_tons * 500 / 30,
    trash_wheel_type = "Professor Trash Wheel"
    ) |> 
  select(trash_wheel_type, everything())
  
prof_trash_df
```

Third, I import Gwynnda Trash Wheel sheet from excel and omit non-data entries.

```{r clean Gwynnda Trash Wheel dataset}

#import dataframe use read_excel
gwynnda_trash_df = 
  read_excel(
    "./data/202309 Trash Wheel Collection Data.xlsx",
    sheet = "Gwynnda Trash Wheel",
    range = "A2:L157",
    na = c("", "NA", "N/A")
    ) |> 
  janitor::clean_names() |> 
  
#re-calculate homes powered
  mutate(
    homes_powered = weight_tons * 500 / 30,
    trash_wheel_type = "Gwynnda Trash Wheel"
    ) |> 
  select(trash_wheel_type, everything())

gwynnda_trash_df
```

Finally, we merge all three dateframes above and calculate total weight of trash collected by Professor Trash Wheel and the total number of cigarette butts collected by Gwynnda in July of 2021.

```{r combine three sheets}
# merge all three dataframes 
data_all = bind_rows(mr_trash_wheel_df, prof_trash_df, gwynnda_trash_df) 

data_all

# calculate total weight of trash collected by Professor Trash Wheel
total_prof_trash_weight = data_all |> 
  filter(trash_wheel_type == "Professor Trash Wheel") |> 
  pull(weight_tons) |> 
  sum()
total_prof_trash_weight

# calculate total number of cigarette butts collected by Gwynnda in July of 2021
total_gwynnda_cigarette_butts_july = data_all |> 
  filter(trash_wheel_type == "Gwynnda Trash Wheel" & month == "July" & year == 2021) |> 
  pull(cigarette_butts) |> 
  sum()
total_gwynnda_cigarette_butts_july

```

The `mr_trash_wheel_df` data has `r nrow(mr_trash_wheel_df)` observations and `r ncol(mr_trash_wheel_df)` variables and tells us about how many tons of garbage Mr trash wheel collects and what types of garbage are included(each variables) for a given year from years `r mr_trash_wheel_df |> pull(year) |> min()` to `r mr_trash_wheel_df |> pull(year) |> max()`. The `prof_trash_df` data has `r nrow(prof_trash_df)` observations and `r ncol(prof_trash_df)` variables, ranging from years `r prof_trash_df |> pull(year) |> min()` to `r prof_trash_df |> pull(year) |> max()`. The `gwynnda_trash_df` data has `r nrow(gwynnda_trash_df)` observations and `r ncol(gwynnda_trash_df)` variables ranging from years `r gwynnda_trash_df |> pull(year) |> min()` to `r gwynnda_trash_df |> pull(year) |> max()`. After we combine three sheets, the `data_all` date fame has`r nrow(data_all)` observations and `r ncol(data_all)` variables and contains all information about trash collected from these three different trash wheels for a given year from `r data_all |> pull(year) |> min()` to `r data_all |> pull(year) |> max()`. The total weight of trash collected by Professor Trash Wheel are `r total_prof_trash_weight` and the total number of cigarette butts collected by Gwynnda in July of 2021 are`r total_gwynnda_cigarette_butts_july`.


## Problem 3

First,import, clean, and tidy the dataset of baseline demographics and remove any participants who do not meet the stated inclusion criteria.

```{r mci_baseline}

mci_baseline_df = 
  read_csv("./data/data_mci/MCI_baseline.csv", 
           skip = 1) |>
  janitor::clean_names() |> 
  mutate(
    sex = ifelse(sex == 1, "male", "female"),
    apoe4 = ifelse(apoe4 == 1, "carrier", "non-carrier" )
         ) 
mci_baseline_df

mci_at_baseline_df = 
  filter(mci_baseline_df, current_age < age_at_onset | is.na(age_at_onset))

mci_at_baseline_df


# calculate for the average baseline age
base_mean_age_mci = mean(pull(mci_at_baseline_df, current_age))


```

